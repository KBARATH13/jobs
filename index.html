<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UngaAreaConnect - Jobs By the Hour</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#6D28D9',
            secondary: '#9333EA',
            success: '#22C55E',
          },
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
    body { font-family: 'Poppins', sans-serif; }
    body.modal-open { overflow: hidden; }
    .job-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .job-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    .truncate-description {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .modal-container { animation: fadeIn 0.3s ease-out; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-50 flex items-center justify-between p-4 sm:p-6 bg-white border-b border-purple-200">
    <div class="text-primary font-bold text-xl sm:text-3xl">UngaAreaConnect</div>
    <nav class="hidden md:flex gap-6 text-gray-700">
      <a href="#" class="hover:text-primary font-medium">Home</a>
      <a href="jobs.html" class="nav-link hover:text-primary font-medium">Find Jobs</a>
      <a href="add.html" class="nav-link hover:text-primary font-medium">Add Job</a>
      <a href="#about" class="hover:text-primary font-medium">About Us</a>
    </nav>
    <div class="flex gap-2 sm:gap-4 items-center">
      <button onclick="window.location.href='contact.html'" class="border-2 border-primary text-primary px-3 sm:px-4 py-2 rounded-lg text-sm font-semibold hover:bg-primary hover:text-white transition">Contact Us</button>
      <div class="flex flex-col gap-2">
        <a href="login.html" id="loginBtn" class="bg-primary text-white px-3 sm:px-4 py-2 rounded-lg text-sm font-semibold hover:bg-secondary transition">Login</a>
        <a href="profile.html" id="profileBtn" class="hidden flex items-center justify-center gap-2 border-2 border-primary text-primary px-3 sm:px-4 py-2 rounded-lg hover:bg-primary hover:text-white transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <span class="text-sm">Profile</span>
        </a>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="min-h-[80vh] flex items-center bg-gradient-to-b from-purple-50 to-white">
    <div class="container mx-auto px-6 grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
      <div class="space-y-6">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-800 leading-tight">
          Enna Friends Job-a? <br>Ithu Ungalukaaga Dhaan!
        </h1>
        <p class="text-gray-500 text-base sm:text-lg">Local jobs for local legends like you.</p>
        <div class="flex items-center gap-4 max-w-md">
          <input 
            id="locationInput"
            type="text" 
            placeholder="Fetching location..." 
            class="w-full h-12 p-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-primary focus:outline-none shadow-sm text-sm"
          />
          <button 
            class="hero-find-job h-12 px-4 sm:px-6 rounded-xl bg-primary text-white text-sm font-semibold hover:bg-secondary transition shadow-md hover:shadow-lg"
          >
            Find Job
          </button>
        </div>
      </div>
      <div class="flex justify-center md:justify-end">
        <img src="https://cdni.iconscout.com/illustration/premium/thumb/job-search-4485285-3733011.png" alt="Hero Illustration" class="w-[250px] sm:w-[300px] md:w-[400px] lg:w-[500px]">
      </div>
    </div>
  </section>

  <!-- Featured Jobs Section -->
  <section class="py-16 text-center">
    <div class="max-w-6xl mx-auto px-6">
      <h2 class="text-2xl sm:text-3xl font-bold text-primary mb-4 underline decoration-secondary">Featured Jobs</h2>
      <p class="text-gray-600 text-base sm:text-lg mb-8 max-w-3xl mx-auto">
        Browse our handpicked selection of local jobs.
      </p>
      <div id="featuredJobListings" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 justify-items-center"></div>
    </div>
  </section>

  <!-- About Us Section -->
  <section id="about" class="py-16 bg-white">
    <div class="max-w-6xl mx-auto px-6 text-center">
      <h2 class="text-2xl sm:text-3xl font-bold text-primary mb-8 underline decoration-secondary">About Us</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 justify-items-center">
        <div class="bg-purple-50 p-6 rounded-xl shadow-lg border border-purple-200 hover:shadow-xl transition transform hover:-translate-y-1">
          <div class="text-primary mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-primary mb-2">Our Mission</h3>
          <p class="text-gray-600 text-sm">
            To empower local communities by connecting people with flexible, accessible job opportunities, fostering financial independence and collaboration.
          </p>
        </div>
        <div class="bg-purple-50 p-6 rounded-xl shadow-lg border border-purple-200 hover:shadow-xl transition transform hover:-translate-y-1">
          <div class="text-primary mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-primary mb-2">Why Choose Us</h3>
          <p class="text-gray-600 text-sm">
            Find or post jobs in minutes with our easy-to-use platform. From one-time gigs to part-time work, we offer verified opportunities tailored to your needs.
          </p>
        </div>
        <div class="bg-purple-50 p-6 rounded-xl shadow-lg border border-purple-200 hover:shadow-xl transition transform hover:-translate-y-1">
          <div class="text-primary mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 005.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-primary mb-2">Community Focus</h3>
          <p class="text-gray-600 text-sm">
            We’re built for local neighborhoods. Our platform supports local talent and businesses, creating a vibrant, connected community.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer id="footer" class="bg-white py-10 border-t border-purple-200">
    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8 text-gray-600 text-sm px-6">
      <div>
        <h3 class="font-bold text-primary mb-4">UngaAreaConnect</h3>
        <p>Call now: <a href="tel:+919876543210" class="text-primary hover:underline">+91 9876543210</a></p>
        <p>Email: <a href="/cdn-cgi/l/email-protection#1576677e787a55203b323434273031333f3e3e3533263c313d3f" class="text-primary hover:underline"><span class="__cf_email__" data-cfemail="1c69787f797b5c2932393f3f2c3d3e3c3031313a3c2b313c3032">[email protected]</span></a></p>
      </div>
      <div>
        <h3 class="font-bold text-primary mb-4">Candidate</h3>
        <ul class="space-y-2">
          <li><a href="jobs.html" class="hover:text-primary">Browse Jobs</a></li>
          <li><a href="#" class="hover:text-primary">Candidate Dashboard</a></li>
          <li><a href="#" class="hover:text-primary">Saved Jobs</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold text-primary mb-4">Employer</h3>
        <ul class="space-y-2">
          <li><a href="add.html" class="hover:text-primary">Post a Job</a></li>
          <li><a href="#" class="hover:text-primary">Browse Candidates</a></li>
          <li><a href="#" class="hover:text-primary">Employer Dashboard</a></li>
        </ul>
      </div>
      <div>
        <h3 class="font-bold text-primary mb-4">Connect Us Via</h3>
        <ul class="space-y-2">
          <li><a href="#about" class="hover:text-primary">About Us</a></li>
          <li><a href="contact.html" class="hover:text-primary">Contact</a></li>
          <li><a href="contact.html" class="hover:text-primary">FAQs</a></li>
        </ul>
      </div>
    </div>
    <div class="mt-10 text-center text-gray-400 text-xs">
      © 2025 UngaAreaConnect - All Rights Reserved
    </div>
  </footer>

  <!-- Job Details Modal -->
  <div id="jobDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="modalJobTitle">
    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto border border-purple-200 modal-container relative">
      <button id="closeJobModalBtn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700" aria-label="Close job details modal">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      <h2 id="modalJobTitle" class="text-xl sm:text-2xl font-bold text-primary mb-4"></h2>
      <div id="modalJobDetails" class="space-y-2 text-gray-600 text-sm"></div>
      <div id="modalLocationLink" class="mt-4 text-sm"></div>
      <div class="mt-6 flex gap-4">
        <button id="applyJobBtn" class="flex-1 bg-primary text-white px-6 py-3 rounded-lg text-sm font-semibold hover:bg-secondary transition" data-job-index="" aria-label="Apply for this job">Apply Job</button>
        <button id="cancelJobModalBtn" class="flex-1 bg-gray-200 text-gray-700 px-6 py-3 rounded-lg text-sm font-semibold hover:bg-gray-300 transition" aria-label="Close modal">Cancel</button>
      </div>
    </div>
  </div>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';

    // Geolocation Function
    function fetchLocation() {
      const locationInput = document.getElementById('locationInput');
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`)
              .then(response => response.json())
              .then(data => {
                if (data.address) {
                  const city = data.address.city || data.address.town || data.address.village || "Unknown Location";
                  const country = data.address.country || "";
                  locationInput.value = `${city}, ${country}`;
                } else {
                  locationInput.value = "Location not found";
                }
              })
              .catch(() => {
                locationInput.value = "Location error";
              });
          },
          () => {
            locationInput.value = "Location unavailable";
          }
        );
      } else {
        locationInput.value = "Geolocation not supported";
      }
    }

    // Extract coordinates from Google Maps URL
    function extractCoordinates(url) {
      const regex = /q=([-.\d]+),([-.\d]+)/;
      const match = url.match(regex);
      if (match) {
        return { lat: parseFloat(match[1]), lon: parseFloat(match[2]) };
      }
      return null;
    }

    // Haversine formula to calculate distance between two coordinates (in km)
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371; // Earth's radius in km
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c; // Distance in km
    }

    // Get user's current location
    function getUserLocation() {
      return new Promise((resolve, reject) => {
        const userData = JSON.parse(localStorage.getItem('userData')) || {};
        if (userData.locationLink) {
          const coords = extractCoordinates(userData.locationLink);
          if (coords) {
            resolve(coords);
          } else {
            reject('Invalid user location link');
          }
        } else if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              resolve({
                lat: position.coords.latitude,
                lon: position.coords.longitude
              });
            },
            () => reject('Location access denied')
          );
        } else {
          reject('Geolocation not supported');
        }
      });
    }

    // Fetch city from location link
    async function getCityFromLocationLink(locationLink) {
      if (!locationLink) return 'Unknown Location';
      const coords = extractCoordinates(locationLink);
      if (!coords) return 'Unknown Location';
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${coords.lat}&lon=${coords.lon}`);
        const data = await response.json();
        return data.address.city || data.address.town || data.address.village || 'Unknown Location';
      } catch {
        return 'Unknown Location';
      }
    }

    // Render Featured Jobs
    async function renderFeaturedJobs() {
      const jobListings = document.getElementById('featuredJobListings');
      jobListings.innerHTML = '';
      const userData = JSON.parse(localStorage.getItem('userData')) || {};
      const preferredJobType = userData.preferredJobType || 'All Types';
      let jobs = JSON.parse(localStorage.getItem('jobs')) || [];

      // Filter by preferred job type
      let filteredJobs = preferredJobType !== 'All Types' 
        ? jobs.filter(job => job.type === preferredJobType) 
        : jobs;

      // Sort by proximity and pay
      try {
        const userCoords = await getUserLocation();
        filteredJobs = filteredJobs.map(job => {
          const coords = extractCoordinates(job.locationLink);
          const distance = coords ? calculateDistance(userCoords.lat, userCoords.lon, coords.lat, coords.lon) : Infinity;
          return { ...job, distance };
        }).sort((a, b) => {
          if (a.distance === b.distance) return b.pay - a.pay; // Sort by pay if distances are equal
          return a.distance - b.distance; // Sort by distance
        }).filter(job => job.pay >= 200 && job.distance <= 50) // High-paying and within 50km
        .slice(0, 3); // Top 3 jobs
      } catch {
        // Fallback to pay-based sorting if location unavailable
        filteredJobs = filteredJobs
          .filter(job => job.pay >= 200)
          .sort((a, b) => b.pay - a.pay)
          .slice(0, 3);
      }

      if (filteredJobs.length === 0) {
        jobListings.innerHTML = '<p class="text-gray-600 col-span-3 text-sm">No high-paying jobs found near you.</p>';
        return;
      }

      for (const [index, job] of filteredJobs.entries()) {
        const globalIndex = jobs.findIndex(j => j.title === job.title);
        const jobCard = document.createElement('div');
        jobCard.className = 'job-card bg-white p-6 rounded-2xl border border-purple-200 shadow-md hover:shadow-lg w-full';
        const isApplied = userData.appliedJobs && userData.appliedJobs.includes(job.title);
        const city = await getCityFromLocationLink(job.locationLink);
        jobCard.innerHTML = `
          <h3 class="text-lg font-bold text-primary mb-2">${job.title}</h3>
          <p class="text-gray-600 text-sm mb-1"><strong>Type:</strong> ${job.type}</p>
          <p class="text-gray-600 text-sm mb-1"><strong>Pay:</strong> ₹${job.pay}/hour</p>
          <p class="text-gray-600 text-sm mb-2"><strong>Location:</strong> ${city}</p>
          <p class="text-gray-600 text-sm truncate-description mb-3">${job.description || 'No description provided'}</p>
          <div class="flex gap-2">
            <button onclick="openJobDetails(${globalIndex})" class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-secondary transition ${isApplied ? 'bg-success cursor-not-allowed' : ''}" ${isApplied ? 'disabled' : ''} aria-label="${isApplied ? 'Job Applied' : 'View details for ' + job.title}">${isApplied ? 'Applied' : 'View Details'}</button>
          </div>
        `;
        jobListings.appendChild(jobCard);
      }
    }

    // Open job details modal
    function openJobDetails(index) {
      if (!isLoggedIn) {
        localStorage.setItem('intendedPage', 'index.html');
        window.location.href = 'login.html';
        return;
      }
      const jobs = JSON.parse(localStorage.getItem('jobs')) || [];
      const userData = JSON.parse(localStorage.getItem('userData')) || {};
      const job = jobs[index];
      const isApplied = userData.appliedJobs && userData.appliedJobs.includes(job.title);
      const modal = document.getElementById('jobDetailsModal');
      const modalTitle = document.getElementById('modalJobTitle');
      const modalDetails = document.getElementById('modalJobDetails');
      const modalLocationLink = document.getElementById('modalLocationLink');
      const applyBtn = document.getElementById('applyJobBtn');

      modalTitle.textContent = job.title;
      modalDetails.innerHTML = `
        <p class="mb-2"><strong>Role:</strong> ${job.role || 'N/A'}</p>
        <p class="mb-2"><strong>Type:</strong> ${job.type || 'N/A'}</p>
        <p class="mb-2"><strong>Vacancies:</strong> ${job.vacancies || 'N/A'}</p>
        <p class="mb-2"><strong>Contact:</strong> ${job.phone ? '+91' + job.phone : 'N/A'}</p>
        <p class="mb-2"><strong>Pay:</strong> ₹${job.pay || 'N/A'}/hour</p>
        <p class="mb-2"><strong>Date:</strong> ${job.date || 'N/A'}</p>
        <p class="mb-2"><strong>Time:</strong> ${job.startTime} - ${job.endTime}</p>
        <p class="mb-2"><strong>City:</strong> ${job.city || 'N/A'}</p>
        <p class="mb-2"><strong>Description:</strong> ${job.description || 'No description provided'}</p>
      `;
      modalLocationLink.innerHTML = job.locationLink ? `<a href="${job.locationLink}" target="_blank" class="text-primary hover:underline">View Location</a>` : 'N/A';
      applyBtn.setAttribute('data-job-index', index);
      applyBtn.textContent = isApplied ? 'Applied' : 'Apply Job';
      applyBtn.className = `flex-1 bg-primary text-white px-6 py-3 rounded-lg text-sm font-semibold hover:bg-secondary transition ${isApplied ? 'bg-success cursor-not-allowed' : ''}`;
      applyBtn.disabled = isApplied;
      modal.classList.remove('hidden');
      document.body.classList.add('modal-open');
    }

    // Apply job
    function markAsApplied(jobIndex) {
      if (!isLoggedIn) {
        localStorage.setItem('intendedPage', 'index.html');
        window.location.href = 'login.html';
        return;
      }
      const jobs = JSON.parse(localStorage.getItem('jobs')) || [];
      const jobTitle = jobs[jobIndex].title;
      const userData = JSON.parse(localStorage.getItem('userData')) || {};
      userData.appliedJobs = userData.appliedJobs || [];
      if (!userData.appliedJobs.includes(jobTitle)) {
        userData.appliedJobs.push(jobTitle);
        localStorage.setItem('userData', JSON.stringify(userData));
      }
      document.getElementById('jobDetailsModal').classList.add('hidden');
      document.body.classList.remove('modal-open');
      alert('Job applied successfully!');
      renderFeaturedJobs();
    }

    // Close modal
    function closeJobModal() {
      document.getElementById('jobDetailsModal').classList.add('hidden');
      document.body.classList.remove('modal-open');
    }

    // Navigation links
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        if (!isLoggedIn) {
          e.preventDefault();
          localStorage.setItem('intendedPage', link.getAttribute('href'));
          window.location.href = 'login.html';
        }
      });
    });

    // Hero find job button
    document.querySelector('.hero-find-job').addEventListener('click', (e) => {
      e.preventDefault();
      if (!isLoggedIn) {
        localStorage.setItem('intendedPage', 'jobs.html');
        window.location.href = 'login.html';
      } else {
        window.location.href = 'jobs.html';
      }
    });

    // Initialize page
    window.onload = () => {
      fetchLocation();
      const loginBtn = document.getElementById('loginBtn');
      const profileBtn = document.getElementById('profileBtn');
      if (isLoggedIn) {
        loginBtn.classList.add('hidden');
        profileBtn.classList.remove('hidden');
      }
      renderFeaturedJobs();

      // Set up modal event listeners
      document.getElementById('closeJobModalBtn').addEventListener('click', closeJobModal);
      document.getElementById('cancelJobModalBtn').addEventListener('click', closeJobModal);
      document.getElementById('applyJobBtn').addEventListener('click', () => {
        const index = parseInt(document.getElementById('applyJobBtn').getAttribute('data-job-index'));
        markAsApplied(index);
      });

      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !document.getElementById('jobDetailsModal').classList.contains('hidden')) {
          closeJobModal();
        }
      });
    };
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93a9705a9ec612d7',t:'MTc0NjM3NjgxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>